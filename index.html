<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AstroChat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f9; }
    header { background: #4a148c; color: white; text-align: center; padding: 1rem; font-size: 1.5rem; }
    .container { padding: 1rem; }
    .section { background: white; padding: 1rem; border-radius: 10px; margin-bottom: 1rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    button { padding: 8px 12px; border: none; border-radius: 6px; background: #4a148c; color: white; cursor: pointer; }
    button:hover { background: #6a1b9a; }
    input, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 6px; }
    .hidden { display: none; }
    .chat-box { border: 1px solid #ccc; border-radius: 10px; padding: 10px; height: 300px; overflow-y: auto; background: #fafafa; }
    .msg-client { text-align: left; margin: 5px; padding: 8px; background: #e1bee7; border-radius: 10px; display: inline-block; }
    .msg-admin { text-align: right; margin: 5px; padding: 8px; background: #c5e1a5; border-radius: 10px; display: inline-block; }
    .admin-panel { background: #fff; padding: 1rem; border-radius: 10px; }
    .tabs { display: flex; margin-bottom: 1rem; }
    .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-bottom: 2px solid #ccc; }
    .tab.active { border-bottom: 2px solid #4a148c; font-weight: bold; }
  </style>
</head>
<body>
  <header>ðŸŒŸ AstroChat ðŸŒŸ</header>
  <div class="container">

    <!-- Client Side -->
    <div id="client-section" class="section">
      <h2>Recharge & Start Chat</h2>
      <p>Scan QR and pay minimum â‚¹10 to start chatting.</p>
      <img src="https://img.icons8.com/color/96/000000/qr-code.png" alt="UPI QR" width="150"><br>
      <img src="https://img.icons8.com/color/48/google-pay.png" alt="GPay" width="40">
      <img src="https://img.icons8.com/color/48/bhim-upi.png" alt="UPI" width="40">
      <img src="https://img.icons8.com/color/48/phone-pe.png" alt="PhonePe" width="40">
      <p>Enter UTR ID after payment:</p>
      <input type="text" id="utrInput" placeholder="Enter UTR ID">
      <button onclick="submitUTR()">Submit</button>
      <p id="utrStatus"></p>

      <div id="chatSection" class="hidden">
        <h3>Live Chat</h3>
        <div class="chat-box" id="chatBox"></div>
        <input type="text" id="clientMsg" placeholder="Type your message...">
        <button onclick="sendClientMsg()">Send</button>
      </div>
    </div>

    <!-- Admin Login -->
    <div class="section">
      <h2>Admin Login</h2>
      <input type="password" id="adminPin" placeholder="Enter Admin PIN">
      <button onclick="loginAdmin()">Login</button>
      <p id="adminLoginMsg"></p>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="section hidden admin-panel">
      <div class="tabs">
        <div id="tab-transactions" class="tab active" onclick="switchTab('transactions')">Transactions</div>
        <div id="tab-chat" class="tab" onclick="switchTab('chat')">Chat</div>
      </div>

      <!-- Transactions Tab -->
      <div id="transactionsTab">
        <h3>Pending Transactions</h3>
        <ul id="pendingTx"></ul>
      </div>

      <!-- Chat Tab -->
      <div id="chatTab" class="hidden">
        <h3>Live Chat with Client</h3>
        <div class="chat-box" id="adminChatBox"></div>
        <input type="text" id="adminMsg" placeholder="Type reply...">
        <button onclick="sendAdminMsg()">Send</button>
      </div>
    </div>
  </div>

  <script>
    let pendingTransactions = [];
    let isApproved = false;

    function submitUTR() {
      let utr = document.getElementById('utrInput').value.trim();
      if (!utr) { alert("Enter UTR ID"); return; }
      pendingTransactions.push(utr);
      document.getElementById('utrStatus').innerText = "Waiting for admin approval...";
      updatePendingList();
    }

    function loginAdmin() {
      let pin = document.getElementById('adminPin').value;
      if (pin === "2103") {
        document.getElementById('adminPanel').classList.remove('hidden');
        document.getElementById('adminLoginMsg').innerText = "Login successful";
      } else {
        document.getElementById('adminLoginMsg').innerText = "Invalid PIN";
      }
    }

    function updatePendingList() {
      let list = document.getElementById('pendingTx');
      list.innerHTML = "";
      pendingTransactions.forEach((utr, index) => {
        let li = document.createElement('li');
        li.innerHTML = utr + 
          " <button onclick='approveTx("+index+")'>Approve</button>" + 
          " <button onclick='rejectTx("+index+")'>Reject</button>";
        list.appendChild(li);
      });
    }

    function approveTx(index) {
      let utr = pendingTransactions[index];
      pendingTransactions.splice(index,1);
      updatePendingList();
      isApproved = true;
      document.getElementById('utrStatus').innerText = "Approved! You can start chat now.";
      document.getElementById('chatSection').classList.remove('hidden');
    }

    function rejectTx(index) {
      let utr = pendingTransactions[index];
      let reason = prompt("Enter rejection reason:");
      pendingTransactions.splice(index,1);
      updatePendingList();
      document.getElementById('utrStatus').innerText = "Rejected: " + reason;
    }

    function sendClientMsg() {
      if (!isApproved) { alert("Wait for approval"); return; }
      let msg = document.getElementById('clientMsg').value;
      if (!msg) return;
      let chat = document.getElementById('chatBox');
      chat.innerHTML += "<div class='msg-client'>"+msg+"</div><br>";
      document.getElementById('clientMsg').value = "";
      document.getElementById('adminChatBox').innerHTML += "<div class='msg-client'>"+msg+"</div><br>";
    }

    function sendAdminMsg() {
      let msg = document.getElementById('adminMsg').value;
      if (!msg) return;
      let chat = document.getElementById('adminChatBox');
      chat.innerHTML += "<div class='msg-admin'>"+msg+"</div><br>";
      document.getElementById('adminMsg').value = "";
      document.getElementById('chatBox').innerHTML += "<div class='msg-admin'>"+msg+"</div><br>";
    }

    function switchTab(tab) {
      document.getElementById('transactionsTab').classList.add('hidden');
      document.getElementById('chatTab').classList.add('hidden');
      document.getElementById('tab-transactions').classList.remove('active');
      document.getElementById('tab-chat').classList.remove('active');
      if (tab === 'transactions') {
        document.getElementById('transactionsTab').classList.remove('hidden');
        document.getElementById('tab-transactions').classList.add('active');
      } else {
        document.getElementById('chatTab').classList.remove('hidden');
        document.getElementById('tab-chat').classList.add('active');
      }
    }
  </script>
</body>
</html>
