<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChatTalk v4</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #chat { border: 1px solid #ccc; padding: 10px; width: 300px; height: 300px; overflow-y: auto; }
    #controls { margin-top: 10px; }
    #timer, #balance { font-weight: bold; margin: 5px 0; }
  </style>
</head>
<body>
  <h2>ChatTalk v4</h2>
  <div id="timer">Time: 00:00</div>
  <div id="balance">Balance: ₹0</div>

  <div id="chat"></div>

  <div id="controls">
    <input type="text" id="messageInput" placeholder="Type message..." />
    <button id="sendBtn">Send</button>
  </div>

  <script>
    const socket = io();
    const timerDiv = document.getElementById("timer");
    const balanceDiv = document.getElementById("balance");
    const chatDiv = document.getElementById("chat");
    const input = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");

    socket.on("init", (data) => {
      balanceDiv.textContent = "Balance: ₹" + data.balance;
    });

    socket.on("timer", (data) => {
      let min = String(Math.floor(data.seconds / 60)).padStart(2, "0");
      let sec = String(data.seconds % 60).padStart(2, "0");
      timerDiv.textContent = "Time: " + min + ":" + sec;
      balanceDiv.textContent = "Balance: ₹" + data.balance;
    });

    socket.on("chat_end", (data) => {
      alert("Chat ended: " + data.reason);
      input.disabled = true;
      sendBtn.disabled = true;
    });

    sendBtn.onclick = () => {
      const msg = input.value;
      if (!msg) return;
      const p = document.createElement("p");
      p.textContent = "You: " + msg;
      chatDiv.appendChild(p);
      input.value = "";
    };
  </script>
</body>
</html>